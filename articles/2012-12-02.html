Title: Route Builders and Actions
Topic: OX
Author: Jesse Luehrs <jesse.luehrs@iinteractive.com>

=head1 The C<route> keyword

The C<route> keyword takes two required arguments, and an optional hash of
additional data. The two required arguments are the I<path> and the
I<action spec>. Valid values for the path will be described tomorrow, but
today's article is how the action spec is interpreted.

=head1 Route builders

Route builders are the part of OX which takes an action spec and determines
which code to run when its associated path is matched. For instance, in this
router:

  router as {
      route '/'          => sub { "Hello world!" };
      route '/posts/:id' => 'posts.view';
  };

C</> uses a route builder which just calls the given coderef directly, while
C</posts/24> uses a route builder which generates a coderef to call the C<view>
method on the C<posts> controller.

There are three default route builders for OX applications:

=over 4

=item *

L<OX::RouteBuilder::Code>

  route '/' => sub { "Hello world!" };

This route builder will be used whenever the action spec is a coderef. It is
the most basic route builder - it just allows you to specify a coderef to call
when the route is chosen.

=item *

L<OX::RouteBuilder::ControllerAction>

  route '/' => 'root.index';

The ControllerAction route builder will be used if the action spec consists of
two words (C<\w+>) separated by a period. Those two words will be used to look
up a controller to use and a method to call on that controller. The controller
is looked up by name among the attributes on the OX application (really
services, but we will discuss that when we explain Bread::Board).

=item *

L<OX::RouteBuilder::HTTPMethod>

  route '/' => 'root';

The HTTPMethod route builder will be used if the action spec consists of a
single word (C<\w+>). This word will be used to look up a controller as in the
ControllerAction route builder, but the method to call will be the lowercase
version of the HTTP method used (C<get>, C<post>, etc). If no appropriate
method is found in the class, it will attempt to call the method named C<any>
instead. If that is also not found, the request will return a 405 error.

=back

You can also define your own route builders, but doing so will be covered in
another article.

=head1 Actions

Once OX determines which code to run to fulfill the request, it will call that
code. The code that is called will receive an L<OX::Request> object as its
first argument (other than the invocant, if called as a method), which can be
used to access all of the request information. The action code should return
the response to use, which can be any of:

=over 4

=item *

Any valid L<PSGI> response

This will be used as-is.

=item *

A string

This will result in a response with a 200 response code and C<Content-Type> set
to C<text/html>.

=item *

An L<OX::Response> object

This will use the result of calling the C<finalize> method. This will typically
be generated by calling C<new_response> on the request object that you receive.

=back

All requests will be decoded and all responses will be encoded as UTF-8
automatically, so your application can deal entirely with Unicode strings.
This behavior can be changed if necessary, but we will discuss that in a future
post.

=cut
